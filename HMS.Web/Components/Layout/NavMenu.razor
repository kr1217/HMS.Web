@*
 * FILE: NavMenu.razor
 * PURPOSE: Layout definition component.
 * COMMUNICATES WITH: None
*@
@implements IDisposable
@inject NavigationManager NavigationManager
@using Radzen.Blazor

<RadzenPanelMenu>
    <AuthorizeView Roles="Patient">
        <Authorized>
            <RadzenPanelMenuItem Text="Main" Icon="home" Expanded="true">
                <RadzenPanelMenuItem Text="Dashboard" Icon="dashboard" Path="patient/dashboard" />
                <RadzenPanelMenuItem Text="OPD Token" Icon="qr_code" Path="patient/token" />
            </RadzenPanelMenuItem>

            <RadzenPanelMenuItem Text="Clinical" Icon="medical_services">
                <RadzenPanelMenuItem Text="Appointments" Icon="calendar_today" Path="patient/appointments" />
                <RadzenPanelMenuItem Text="Prescriptions" Icon="description" Path="patient/prescriptions" />
                <RadzenPanelMenuItem Text="Reports" Icon="assignment" Path="patient/reports" />
                <RadzenPanelMenuItem Text="Operations" Icon="medical_services" Path="patient/operations" />
            </RadzenPanelMenuItem>

            <RadzenPanelMenuItem Text="Financial" Icon="payments">
                <RadzenPanelMenuItem Text="My Bills" Icon="payment" Path="patient/bills" />
            </RadzenPanelMenuItem>

            <RadzenPanelMenuItem Text="Services" Icon="room_service">
                <RadzenPanelMenuItem Text="Consultation" Icon="video_call" Path="patient/consultation" />
                <RadzenPanelMenuItem Text="Support" Icon="help_outline" Path="patient/support" />
            </RadzenPanelMenuItem>
        </Authorized>
    </AuthorizeView>

    <AuthorizeView Roles="Doctor">
        <Authorized>
            <RadzenPanelMenuItem Text="Doctor" Icon="medical_services" Expanded="true">
                <RadzenPanelMenuItem Text="Dashboard" Icon="dashboard" Path="doctor/dashboard" />
                <RadzenPanelMenuItem Text="Patient Records" Icon="people" Path="doctor/patients" />
            </RadzenPanelMenuItem>
        </Authorized>
    </AuthorizeView>

    <AuthorizeView Roles="Admin">
        <Authorized>
            <RadzenPanelMenuItem Text="Admin" Icon="admin_panel_settings" Expanded="true">
                <RadzenPanelMenuItem Text="Dashboard" Icon="dashboard" Path="admin/dashboard" />
                <RadzenPanelMenuItem Text="Seed Database" Icon="storage" Path="admin/seed-database" />
            </RadzenPanelMenuItem>
        </Authorized>
    </AuthorizeView>

    <AuthorizeView Roles="Teller">
        <Authorized>
            <RadzenPanelMenuItem Text="Financial Bureau" Icon="account_balance_wallet" Expanded="true">
                <RadzenPanelMenuItem Text="Teller Desk" Icon="desk" Path="teller/dashboard" />
            </RadzenPanelMenuItem>
        </Authorized>
    </AuthorizeView>

    <AuthorizeView Roles="OTStaff">
        <Authorized>
            <RadzenPanelMenuItem Text="Surgical Unit" Icon="medical_services" Expanded="true">
                <RadzenPanelMenuItem Text="OT Dashboard" Icon="dashboard" Path="ot-staff/dashboard" />
            </RadzenPanelMenuItem>
        </Authorized>
    </AuthorizeView>

    <AuthorizeView>
        <NotAuthorized>
            <RadzenPanelMenuItem Text="Welcome" Icon="handshake" Expanded="true">
                <RadzenPanelMenuItem Text="Login" Icon="login" Path="Account/Login" />
                <RadzenPanelMenuItem Text="Register" Icon="person_add" Path="Account/Register" />
            </RadzenPanelMenuItem>
        </NotAuthorized>
    </AuthorizeView>
</RadzenPanelMenu>

@code {
    private string? currentUrl;

    protected override void OnInitialized()
    {
        currentUrl = NavigationManager.ToBaseRelativePath(NavigationManager.Uri);
        NavigationManager.LocationChanged += OnLocationChanged;
    }

    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        currentUrl = NavigationManager.ToBaseRelativePath(e.Location);
        StateHasChanged();
    }

    public void Dispose()
    {
        NavigationManager.LocationChanged -= OnLocationChanged;
    }
}

