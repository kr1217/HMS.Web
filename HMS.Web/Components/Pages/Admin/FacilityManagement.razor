@page "/admin/facilities"
@layout HMS.Web.Components.Layout.AdminLayout
@rendermode InteractiveServer
@attribute [Authorize(Roles = "Admin")]
@inject FacilityRepository FacilityRepo
@inject DialogService DialogService
@inject NotificationService NotificationService
@using HMS.Web.Models
@using HMS.Web.DAL
@using Radzen
@using Radzen.Blazor

<PageTitle>Facility Management | Admin</PageTitle>

<RadzenStack Gap="1.5rem" Class="rz-p-4 rz-p-md-6">
    <RadzenStack Gap="0.5rem">
        <RadzenText Text="Infrastructure & Facilities" TextStyle="TextStyle.H4" Class="rz-m-0 rz-color-primary" />
        <RadzenText Text="Holistic management of hospital inventory, ward configurations, and real-time bed occupancy."
            TextStyle="TextStyle.Body1" Class="rz-color-text-secondary" />
    </RadzenStack>

    <RadzenTabs RenderMode="TabRenderMode.Server" Change="@OnTabChange" Class="rz-shadow-2 rz-border-radius-2">
        <Tabs>
            <!-- Live Status Tab -->
            <RadzenTabsItem Text="Live Occupancy Status" Icon="sensors">
                <RadzenStack Gap="2rem" Class="rz-p-4">
                    @if (isLoading)
                    {
                        <RadzenStack AlignItems="AlignItems.Center" Class="rz-p-12">
                            <RadzenProgressBar Mode="ProgressBarMode.Indeterminate" Style="width: 200px;" />
                            <RadzenText Text="Synchronizing facility data..." TextStyle="TextStyle.Caption" />
                        </RadzenStack>
                    }
                    else if (!beds.Any())
                    {
                        <RadzenText Text="No facility data available." Class="rz-text-align-center rz-p-12" />
                    }
                    else
                    {
                        <RadzenText Text="@($"Total Visible Beds: {beds.Count()}")" TextStyle="TextStyle.Caption"
                            Class="rz-mb-4" />
                        @foreach (var wardGroup in beds.GroupBy(b => b.WardName).OrderBy(g => g.Key))
                        {
                            <RadzenCard Class="rz-p-0" Style="overflow: hidden; border-radius: 12px;">
                                <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center"
                                    Class="rz-p-4 rz-background-color-primary-darker">
                                    <RadzenIcon Icon="domain" Style="color: white;" />
                                    <RadzenText Text="@(wardGroup.Key ?? "Unassigned Clinical Area")" TextStyle="TextStyle.H6"
                                        Class="rz-m-0" Style="color: white;" />
                                </RadzenStack>

                                <RadzenStack Gap="1.5rem" Class="rz-p-6">
                                    <RadzenRow Gap="1.5rem">
                                        @foreach (var roomGroup in wardGroup.GroupBy(b => b.RoomNumber).OrderBy(g => g.Key))
                                        {
                                            <RadzenColumn Size="12" SizeMD="4" SizeLG="3">
                                                <RadzenCard Class="rz-variant-flat rz-background-color-base-100 rz-p-4"
                                                    Style="border: 1px solid var(--rz-border-color-light);">
                                                    <RadzenText Text="@($"Room {roomGroup.Key ?? "N/A"}")"
                                                        TextStyle="TextStyle.Subtitle2"
                                                        Class="rz-mb-4 rz-border-bottom rz-pb-2 rz-color-text-secondary" />
                                                    <RadzenStack Orientation="Orientation.Horizontal" Wrap="FlexWrap.Wrap"
                                                        Gap="0.5rem">
                                                        @foreach (var bed in roomGroup)
                                                        {
                                                            <RadzenCard @onclick="() => EditBed(bed)"
                                                                Class="@($"rz-p-2 rz-text-align-center {GetBedStatusClass(bed.Status)}")"
                                                                Style="min-width: 70px; cursor: pointer; border-radius: 8px; flex: 1;">
                                                                <RadzenText Text="@bed.BedNumber" TextStyle="TextStyle.Subtitle2"
                                                                    Class="rz-m-0 rz-font-weight-bold" />
                                                                <RadzenText Text="@bed.Status" TextStyle="TextStyle.Overline"
                                                                    Class="rz-m-0" />
                                                            </RadzenCard>
                                                        }
                                                    </RadzenStack>
                                                </RadzenCard>
                                            </RadzenColumn>
                                        }
                                    </RadzenRow>
                                </RadzenStack>
                            </RadzenCard>
                        }
                    }
                </RadzenStack>
            </RadzenTabsItem>

            <!-- Wards Tab -->
            <RadzenTabsItem Text="Clinical Wards" Icon="lan">
                <RadzenStack Gap="1rem" Class="rz-p-4">
                    <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End">
                        <RadzenButton Icon="add_circle" Text="Provision New Ward" ButtonStyle="ButtonStyle.Primary"
                            Click="@InsertWard" />
                    </RadzenStack>
                    <RadzenDataGrid @ref="wardGrid" Data="@wards" TItem="Ward" Count="@wardCount"
                        LoadData="@LoadWardsData" RowUpdate="@OnUpdateWard" RowCreate="@OnCreateWard"
                        AllowFiltering="true" AllowPaging="true" PageSize="10" AllowSorting="true">
                        <Columns>
                            <RadzenDataGridColumn TItem="Ward" Property="WardId" Title="ID" Width="80px"
                                TextAlign="TextAlign.Center" />
                            <RadzenDataGridColumn TItem="Ward" Property="WardName" Title="Ward Designation">
                                <EditTemplate Context="ward">
                                    <RadzenTextBox @bind-Value="ward.WardName" Style="width:100%" Name="WardName" />
                                    <RadzenRequiredValidator Text="Designation is required" Component="WardName"
                                        Popup="true" />
                                </EditTemplate>
                            </RadzenDataGridColumn>
                            <RadzenDataGridColumn TItem="Ward" Property="Floor" Title="Floor Elevation">
                                <EditTemplate Context="ward">
                                    <RadzenTextBox @bind-Value="ward.Floor" Style="width:100%" />
                                </EditTemplate>
                            </RadzenDataGridColumn>
                            <RadzenDataGridColumn TItem="Ward" Property="Wing" Title="Facility Wing">
                                <EditTemplate Context="ward">
                                    <RadzenTextBox @bind-Value="ward.Wing" Style="width:100%" />
                                </EditTemplate>
                            </RadzenDataGridColumn>
                            <RadzenDataGridColumn TItem="Ward" Property="IsActive" Title="Operational Status"
                                Width="150px" TextAlign="TextAlign.Center">
                                <Template Context="ward">
                                    <RadzenBadge BadgeStyle="@(ward.IsActive ? BadgeStyle.Success : BadgeStyle.Danger)"
                                        Text="@(ward.IsActive ? "ACTIVE" : "INACTIVE")" IsPill="true" />
                                </Template>
                                <EditTemplate Context="ward">
                                    <RadzenSwitch @bind-Value="ward.IsActive" />
                                </EditTemplate>
                            </RadzenDataGridColumn>
                            <RadzenDataGridColumn TItem="Ward" Context="ward" Filterable="false" Sortable="false"
                                TextAlign="TextAlign.Right" Width="120px">
                                <Template Context="ward">
                                    <RadzenButton Icon="edit" ButtonStyle="ButtonStyle.Light" Variant="Variant.Flat"
                                        Size="ButtonSize.Medium" Click="@(args => EditWard(ward))"
                                        @onclick:stopPropagation="true" />
                                </Template>
                                <EditTemplate Context="ward">
                                    <RadzenStack Orientation="Orientation.Horizontal" Gap="0.5rem"
                                        JustifyContent="JustifyContent.End">
                                        <RadzenButton Icon="check" ButtonStyle="ButtonStyle.Success"
                                            Variant="Variant.Flat" Size="ButtonSize.Medium"
                                            Click="@((args) => SaveWard(ward))" />
                                        <RadzenButton Icon="close" ButtonStyle="ButtonStyle.Light"
                                            Variant="Variant.Flat" Size="ButtonSize.Medium"
                                            Click="@((args) => CancelEditWard(ward))" />
                                    </RadzenStack>
                                </EditTemplate>
                            </RadzenDataGridColumn>
                        </Columns>
                    </RadzenDataGrid>
                </RadzenStack>
            </RadzenTabsItem>

            <!-- Room Types Tab -->
            <RadzenTabsItem Text="Accommodation Tiers" Icon="payments">
                <RadzenStack Gap="1rem" Class="rz-p-4">
                    <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End">
                        <RadzenButton Icon="add_circle" Text="Define Pricing Tier" ButtonStyle="ButtonStyle.Primary"
                            Click="@InsertRoomType" />
                    </RadzenStack>
                    <RadzenDataGrid @ref="roomTypeGrid" Data="@roomTypes" TItem="RoomType" Count="@roomTypeCount"
                        LoadData="@LoadRoomTypesData" RowUpdate="@OnUpdateRoomType" RowCreate="@OnCreateRoomType"
                        AllowFiltering="true" AllowPaging="true" PageSize="10" AllowSorting="true">
                        <Columns>
                            <RadzenDataGridColumn TItem="RoomType" Property="TypeName" Title="Tier Designation">
                                <EditTemplate Context="type">
                                    <RadzenTextBox @bind-Value="type.TypeName" Style="width:100%" Name="TypeName" />
                                    <RadzenRequiredValidator Component="TypeName" Text="Designation required"
                                        Popup="true" />
                                </EditTemplate>
                            </RadzenDataGridColumn>
                            <RadzenDataGridColumn TItem="RoomType" Property="DailyRate" Title="Diurnal Tariff"
                                Width="150px">
                                <Template Context="type">
                                    <RadzenText Text="@type.DailyRate.ToString("C")" TextStyle="TextStyle.Body2"
                                        Class="rz-font-weight-bold" />
                                </Template>
                                <EditTemplate Context="type">
                                    <RadzenNumeric @bind-Value="type.DailyRate" Style="width:100%" Format="C" />
                                </EditTemplate>
                            </RadzenDataGridColumn>
                            <RadzenDataGridColumn TItem="RoomType" Property="Description"
                                Title="Clinical Specifications">
                                <EditTemplate Context="type">
                                    <RadzenTextBox @bind-Value="type.Description" Style="width:100%" />
                                </EditTemplate>
                            </RadzenDataGridColumn>
                            <RadzenDataGridColumn TItem="RoomType" Context="type" Filterable="false" Sortable="false"
                                TextAlign="TextAlign.Right" Width="120px">
                                <Template Context="type">
                                    <RadzenButton Icon="edit" ButtonStyle="ButtonStyle.Light" Variant="Variant.Flat"
                                        Size="ButtonSize.Medium" Click="@(args => EditRoomType(type))" />
                                </Template>
                                <EditTemplate Context="type">
                                    <RadzenStack Orientation="Orientation.Horizontal" Gap="0.5rem"
                                        JustifyContent="JustifyContent.End">
                                        <RadzenButton Icon="check" ButtonStyle="ButtonStyle.Success"
                                            Variant="Variant.Flat" Size="ButtonSize.Medium"
                                            Click="@((args) => SaveRoomType(type))" />
                                        <RadzenButton Icon="close" ButtonStyle="ButtonStyle.Light"
                                            Variant="Variant.Flat" Size="ButtonSize.Medium"
                                            Click="@((args) => CancelEditRoomType(type))" />
                                    </RadzenStack>
                                </EditTemplate>
                            </RadzenDataGridColumn>
                        </Columns>
                    </RadzenDataGrid>
                </RadzenStack>
            </RadzenTabsItem>

            <!-- Rooms Tab -->
            <RadzenTabsItem Text="Patient Rooms" Icon="meeting_room">
                <RadzenStack Gap="1rem" Class="rz-p-4">
                    <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End">
                        <RadzenButton Icon="add_circle" Text="Commission New Room" ButtonStyle="ButtonStyle.Primary"
                            Click="@InsertRoom" />
                    </RadzenStack>
                    <RadzenDataGrid @ref="roomGrid" Data="@rooms" TItem="Room" Count="@roomCount"
                        LoadData="@LoadRoomsData" RowUpdate="@OnUpdateRoom" RowCreate="@OnCreateRoom"
                        AllowFiltering="true" AllowPaging="true" PageSize="10" AllowSorting="true">
                        <Columns>
                            <RadzenDataGridColumn TItem="Room" Property="RoomNumber" Title="Room Identifier">
                                <EditTemplate Context="room">
                                    <RadzenTextBox @bind-Value="room.RoomNumber" Style="width:100%" Name="RoomNumber" />
                                    <RadzenRequiredValidator Component="RoomNumber" Text="Identifier required"
                                        Popup="true" />
                                </EditTemplate>
                            </RadzenDataGridColumn>
                            <RadzenDataGridColumn TItem="Room" Property="WardId" Title="Clinical Ward">
                                <Template Context="room">@room.WardName</Template>
                                <EditTemplate Context="room">
                                    <RadzenDropDown @bind-Value="room.WardId" Data="@allWardsCached"
                                        TextProperty="WardName" ValueProperty="WardId" Style="width:100%" />
                                </EditTemplate>
                            </RadzenDataGridColumn>
                            <RadzenDataGridColumn TItem="Room" Property="RoomTypeId" Title="Service Tier">
                                <Template Context="room">@room.RoomTypeName</Template>
                                <EditTemplate Context="room">
                                    <RadzenDropDown @bind-Value="room.RoomTypeId" Data="@allRoomTypesCached"
                                        TextProperty="TypeName" ValueProperty="RoomTypeId" Style="width:100%" />
                                </EditTemplate>
                            </RadzenDataGridColumn>
                            <RadzenDataGridColumn TItem="Room" Context="room" TextAlign="TextAlign.Right" Width="120px"
                                Sortable="false" Filterable="false">
                                <Template Context="room">
                                    <RadzenButton Icon="edit" ButtonStyle="ButtonStyle.Light"
                                        Click="@(args => EditRoom(room))" />
                                </Template>
                                <EditTemplate Context="room">
                                    <RadzenStack Orientation="Orientation.Horizontal" Gap="0.5rem"
                                        JustifyContent="JustifyContent.End">
                                        <RadzenButton Icon="check" ButtonStyle="ButtonStyle.Success"
                                            Click="@((args) => SaveRoom(room))" />
                                        <RadzenButton Icon="close" ButtonStyle="ButtonStyle.Light"
                                            Click="@((args) => CancelEditRoom(room))" />
                                    </RadzenStack>
                                </EditTemplate>
                            </RadzenDataGridColumn>
                        </Columns>
                    </RadzenDataGrid>
                </RadzenStack>
            </RadzenTabsItem>

            <!-- Operation Theaters Tab -->
            <RadzenTabsItem Text="Surgical Theaters" Icon="medical_services">
                <RadzenStack Gap="1rem" Class="rz-p-4">
                    <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End">
                        <RadzenButton Icon="add_circle" Text="Provision New Theater" ButtonStyle="ButtonStyle.Primary"
                            Click="@InsertTheater" />
                    </RadzenStack>
                    <RadzenDataGrid @ref="theaterGrid" Data="@theaters" TItem="OperationTheater"
                        RowUpdate="@OnUpdateTheater" RowCreate="@OnCreateTheater" AllowFiltering="true"
                        AllowPaging="true" PageSize="10">
                        <Columns>
                            <RadzenDataGridColumn TItem="OperationTheater" Property="TheaterName"
                                Title="Theater Designation">
                                <EditTemplate Context="theater">
                                    <RadzenTextBox @bind-Value="theater.TheaterName" Style="width:100%"
                                        Name="TheaterName" />
                                    <RadzenRequiredValidator Component="TheaterName" Text="Designation required"
                                        Popup="true" />
                                </EditTemplate>
                            </RadzenDataGridColumn>
                            <RadzenDataGridColumn TItem="OperationTheater" Property="Status" Title="Sanitarian Status">
                                <Template Context="theater">
                                    <RadzenBadge Text="@theater.Status"
                                        BadgeStyle="@GetTheaterStatusBadge(theater.Status)" IsPill="true" />
                                </Template>
                                <EditTemplate Context="theater">
                                    <RadzenDropDown @bind-Value="theater.Status"
                                        Data="@(new[] { "Available", "Occupied", "Maintenance", "Cleaning" })"
                                        Style="width:100%" />
                                </EditTemplate>
                            </RadzenDataGridColumn>
                            <RadzenDataGridColumn TItem="OperationTheater" Property="IsActive"
                                Title="Operational Readiness" Width="180px" TextAlign="TextAlign.Center">
                                <Template Context="theater">
                                    <RadzenBadge
                                        BadgeStyle="@(theater.IsActive ? BadgeStyle.Success : BadgeStyle.Danger)"
                                        Text="@(theater.IsActive ? "ONLINE" : "OFFLINE")" IsPill="true" />
                                </Template>
                                <EditTemplate Context="theater">
                                    <RadzenSwitch @bind-Value="theater.IsActive" />
                                </EditTemplate>
                            </RadzenDataGridColumn>
                            <RadzenDataGridColumn TItem="OperationTheater" Context="theater" TextAlign="TextAlign.Right"
                                Width="120px">
                                <Template Context="theater">
                                    <RadzenButton Icon="edit" ButtonStyle="ButtonStyle.Light"
                                        Click="@(args => EditTheater(theater))" />
                                </Template>
                                <EditTemplate Context="theater">
                                    <RadzenStack Orientation="Orientation.Horizontal" Gap="0.5rem"
                                        JustifyContent="JustifyContent.End">
                                        <RadzenButton Icon="check" ButtonStyle="ButtonStyle.Success"
                                            Click="@((args) => SaveTheater(theater))" />
                                        <RadzenButton Icon="close" ButtonStyle="ButtonStyle.Light"
                                            Click="@((args) => CancelEditTheater(theater))" />
                                    </RadzenStack>
                                </EditTemplate>
                            </RadzenDataGridColumn>
                        </Columns>
                    </RadzenDataGrid>
                </RadzenStack>
            </RadzenTabsItem>

            <!-- Beds Tab -->
            <RadzenTabsItem Text="Patient Beds" Icon="bed">
                <RadzenStack Gap="1rem" Class="rz-p-4">
                    <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.End">
                        <RadzenButton Icon="add_circle" Text="Inventory New Bed" ButtonStyle="ButtonStyle.Primary"
                            Click="@InsertBed" />
                    </RadzenStack>
                    <RadzenDataGrid @ref="bedGrid" Data="@beds" TItem="Bed" Count="@bedCount" LoadData="@LoadBedsData"
                        RowUpdate="@OnUpdateBed" RowCreate="@OnCreateBed" AllowFiltering="true" AllowPaging="true"
                        PageSize="10" AllowSorting="true">
                        <Columns>
                            <RadzenDataGridColumn TItem="Bed" Property="BedNumber" Title="Bed Serial Identifier">
                                <EditTemplate Context="bed">
                                    <RadzenTextBox @bind-Value="bed.BedNumber" Style="width:100%" Name="BedNumber" />
                                    <RadzenRequiredValidator Component="BedNumber" Text="Serial required"
                                        Popup="true" />
                                </EditTemplate>
                            </RadzenDataGridColumn>
                            <RadzenDataGridColumn TItem="Bed" Property="RoomId" Title="Assigned Location">
                                <Template Context="bed">@bed.RoomNumber (@bed.WardName)</Template>
                                <EditTemplate Context="bed">
                                    <RadzenDropDown @bind-Value="bed.RoomId" Data="@allRoomsCached"
                                        TextProperty="RoomNumber" ValueProperty="RoomId" Style="width:100%" />
                                </EditTemplate>
                            </RadzenDataGridColumn>
                            <RadzenDataGridColumn TItem="Bed" Property="Status" Title="Clinical State">
                                <Template Context="bed">
                                    <RadzenBadge Text="@bed.Status" BadgeStyle="@GetTheaterStatusBadge(bed.Status)"
                                        IsPill="true" />
                                </Template>
                                <EditTemplate Context="bed">
                                    <RadzenDropDown @bind-Value="bed.Status"
                                        Data="@(new[] { "Available", "Occupied", "Maintenance", "Cleaning" })"
                                        Style="width:100%" />
                                </EditTemplate>
                            </RadzenDataGridColumn>
                            <RadzenDataGridColumn TItem="Bed" Context="bed" TextAlign="TextAlign.Right" Width="120px"
                                Sortable="false" Filterable="false">
                                <Template Context="bed">
                                    <RadzenButton Icon="edit" ButtonStyle="ButtonStyle.Light"
                                        Click="@(args => EditBed(bed))" />
                                </Template>
                                <EditTemplate Context="bed">
                                    <RadzenStack Orientation="Orientation.Horizontal" Gap="0.5rem"
                                        JustifyContent="JustifyContent.End">
                                        <RadzenButton Icon="check" ButtonStyle="ButtonStyle.Success"
                                            Click="@((args) => SaveBed(bed))" />
                                        <RadzenButton Icon="close" ButtonStyle="ButtonStyle.Light"
                                            Click="@((args) => CancelEditBed(bed))" />
                                    </RadzenStack>
                                </EditTemplate>
                            </RadzenDataGridColumn>
                        </Columns>
                    </RadzenDataGrid>
                </RadzenStack>
            </RadzenTabsItem>
        </Tabs>
    </RadzenTabs>
</RadzenStack>

@code {
    bool isLoading = false;
    int currentTabIndex = 0;

    // Data Counters
    int wardCount;
    int roomTypeCount;
    int roomCount;
    int bedCount;

    // Cache for dropdowns (loaded as needed)
    List<Ward> allWardsCached = new();
    List<RoomType> allRoomTypesCached = new();
    List<Room> allRoomsCached = new();

    IEnumerable<Ward> wards = new List<Ward>();
    IEnumerable<RoomType> roomTypes = new List<RoomType>();
    IEnumerable<Room> rooms = new List<Room>();
    IEnumerable<Bed> beds = new List<Bed>();
    IEnumerable<OperationTheater> theaters = new List<OperationTheater>();

    RadzenDataGrid<Ward> wardGrid = default!;
    RadzenDataGrid<RoomType> roomTypeGrid = default!;
    RadzenDataGrid<Room> roomGrid = default!;
    RadzenDataGrid<Bed> bedGrid = default!;
    RadzenDataGrid<OperationTheater> theaterGrid = default!;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            if (wardGrid != null) await wardGrid.Reload();
            if (roomTypeGrid != null) await roomTypeGrid.Reload();
            if (roomGrid != null) await roomGrid.Reload();
            if (theaterGrid != null) await theaterGrid.Reload();
            if (bedGrid != null) await bedGrid.Reload();
            StateHasChanged();
        }
    }

    protected override void OnInitialized()
    {
        // Load initial status data (limited to top 100 for occupancy view)
        beds = FacilityRepo.GetBeds();
    }

    void OnTabChange(int index)
    {
        currentTabIndex = index;
        // Grids will trigger LoadData automatically if they are visible
        StateHasChanged();

        // Pre-load caches for dropdowns if needed
        if (index == 3) { allWardsCached = FacilityRepo.GetWards(); allRoomTypesCached = FacilityRepo.GetRoomTypes(); }
        if (index == 5) { allRoomsCached = FacilityRepo.GetRooms(); }
    }

    async Task LoadWardsData(LoadDataArgs args)
    {
        wards = FacilityRepo.GetWardsPaged(args.Skip ?? 0, args.Top ?? 10, args.OrderBy);
        wardCount = FacilityRepo.GetWardsCount();
        StateHasChanged();
    }

    async Task LoadRoomTypesData(LoadDataArgs args)
    {
        roomTypes = FacilityRepo.GetRoomTypesPaged(args.Skip ?? 0, args.Top ?? 10, args.OrderBy);
        roomTypeCount = FacilityRepo.GetRoomTypesCount();
        StateHasChanged();
    }

    async Task LoadRoomsData(LoadDataArgs args)
    {
        rooms = FacilityRepo.GetRoomsPaged(args.Skip ?? 0, args.Top ?? 10, args.OrderBy);
        roomCount = FacilityRepo.GetRoomsCount();
        StateHasChanged();
    }

    async Task LoadBedsData(LoadDataArgs args)
    {
        beds = FacilityRepo.GetBedsPaged(args.Skip ?? 0, args.Top ?? 10, args.OrderBy);
        bedCount = FacilityRepo.GetBedsCount();
        StateHasChanged();
    }

    string GetBedStatusClass(string status)
    {
        return status switch
        {
            "Available" => "rz-background-color-success-lighter rz-color-success-darker rz-border-success",
            "Occupied" => "rz-background-color-danger-lighter rz-color-danger-darker rz-border-danger",
            "Maintenance" => "rz-background-color-warning-lighter rz-color-warning-darker rz-border-warning",
            "Cleaning" => "rz-background-color-info-lighter rz-color-info-darker rz-border-info",
            _ => ""
        };
    }

    BadgeStyle GetTheaterStatusBadge(string status)
    {
        return status switch
        {
            "Available" => BadgeStyle.Success,
            "Occupied" => BadgeStyle.Danger,
            "Maintenance" => BadgeStyle.Warning,
            "Cleaning" => BadgeStyle.Info,
            _ => BadgeStyle.Light
        };
    }

    // --- Ward CRUD ---
    async Task InsertWard() { await wardGrid.InsertRow(new Ward() { WardName = "New Ward", IsActive = true }); }
    async Task EditWard(Ward ward) { await wardGrid.EditRow(ward); }
    async Task SaveWard(Ward ward) { await wardGrid.UpdateRow(ward); }
    void CancelEditWard(Ward ward) { wardGrid.CancelEditRow(ward); }
    void OnCreateWard(Ward ward)
    {
        FacilityRepo.SaveWard(ward); wardGrid.Reload();
        NotificationService.Notify(NotificationSeverity.Success, "Ward Provisioned");
    }
    void OnUpdateWard(Ward ward)
    {
        FacilityRepo.SaveWard(ward); wardGrid.Reload();
        NotificationService.Notify(NotificationSeverity.Success, "Ward Updated");
    }

    // --- RoomType CRUD ---
    async Task InsertRoomType() { await roomTypeGrid.InsertRow(new RoomType() { TypeName = "New Tier" }); }
    async Task EditRoomType(RoomType type) { await roomTypeGrid.EditRow(type); }
    async Task SaveRoomType(RoomType type) { await roomTypeGrid.UpdateRow(type); }
    void CancelEditRoomType(RoomType type) { roomTypeGrid.CancelEditRow(type); }
    void OnCreateRoomType(RoomType type)
    {
        FacilityRepo.SaveRoomType(type); roomTypeGrid.Reload();
        NotificationService.Notify(NotificationSeverity.Success, "Pricing Tier Defined");
    }
    void OnUpdateRoomType(RoomType type)
    {
        FacilityRepo.SaveRoomType(type); roomTypeGrid.Reload();
        NotificationService.Notify(NotificationSeverity.Success, "Tier Updated");
    }

    // --- Room CRUD ---
    async Task InsertRoom() { await roomGrid.InsertRow(new Room() { RoomNumber = "101", IsActive = true }); }
    async Task EditRoom(Room room) { await roomGrid.EditRow(room); }
    async Task SaveRoom(Room room) { await roomGrid.UpdateRow(room); }
    void CancelEditRoom(Room room) { roomGrid.CancelEditRow(room); }
    void OnCreateRoom(Room room)
    {
        FacilityRepo.SaveRoom(room); roomGrid.Reload();
        NotificationService.Notify(NotificationSeverity.Success, "Room Commissioned");
    }
    void OnUpdateRoom(Room room)
    {
        FacilityRepo.SaveRoom(room); roomGrid.Reload();
        NotificationService.Notify(NotificationSeverity.Success, "Room Updated");
    }

    // --- Bed CRUD ---
    async Task InsertBed()
    {
        await bedGrid.InsertRow(new Bed() { BedNumber = "A", Status = "Available", IsActive = true });
    }
    async Task EditBed(Bed bed) { await bedGrid.EditRow(bed); }
    async Task SaveBed(Bed bed) { await bedGrid.UpdateRow(bed); }
    void CancelEditBed(Bed bed) { bedGrid.CancelEditRow(bed); }
    void OnCreateBed(Bed bed)
    {
        FacilityRepo.SaveBed(bed); bedGrid.Reload();
        NotificationService.Notify(NotificationSeverity.Success, "Bed Inventoried");
    }
    void OnUpdateBed(Bed bed)
    {
        FacilityRepo.SaveBed(bed); bedGrid.Reload();
        NotificationService.Notify(NotificationSeverity.Success, "Bed Updated");
    }

    // --- Theater CRUD ---
    async Task InsertTheater()
    {
        await theaterGrid.InsertRow(new OperationTheater()
            {
                TheaterName = "New OT",
                Status =
            "Available",
                IsActive = true
            });
    }
    async Task EditTheater(OperationTheater theater) { await theaterGrid.EditRow(theater); }
    async Task SaveTheater(OperationTheater theater) { await theaterGrid.UpdateRow(theater); }
    void CancelEditTheater(OperationTheater theater) { theaterGrid.CancelEditRow(theater); }
    void OnCreateTheater(OperationTheater theater)
    {
        FacilityRepo.SaveTheater(theater); theaterGrid.Reload();
        NotificationService.Notify(NotificationSeverity.Success, "Theater Provisioned");
    }
    void OnUpdateTheater(OperationTheater theater)
    {
        FacilityRepo.SaveTheater(theater); theaterGrid.Reload();
        NotificationService.Notify(NotificationSeverity.Success, "Theater Updated");
    }
}
